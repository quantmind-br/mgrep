---
description: High-level architecture, core concepts, and technology stack for mgrep.
globs:
  - "*"
alwaysApply: true
---

# mgrep Project Overview

`mgrep` is a semantic search and file indexing CLI tool that bridges local codebases with vector-based retrieval and LLM-powered question answering.

## Architectural Layers
- **CLI Layer (`src/commands/`)**: Command parsing using `commander`. Includes `search`, `watch`, and `mcp` (Model Context Protocol).
- **Service Layer (`src/lib/`)**: Core logic for file system traversal, git integration, and the `initialSync` reconciliation logic.
- **Provider Layer (`src/lib/providers/`)**: Abstracted interfaces for Embeddings and LLMs (OpenAI, Google, Anthropic, Ollama).
- **Storage Layer (`src/lib/qdrant-store.ts`)**: Concrete implementation of the `Store` interface using Qdrant.

## Core Concepts
- **Sync-on-Demand**: The system reconciles local file state with the vector store before search/query operations using SHA256 hashes.
- **Deterministic Point IDs**: Qdrant point IDs are generated via `generatePointId(externalId, chunkIndex)` to ensure idempotent updates.
- **Path Scoping**: Files are indexed with `path_scopes` (e.g., `/src/lib/file.ts` -> `["/", "/src", "/src/lib", "/src/lib/file.ts"]`) to enable efficient hierarchical filtering.
- **MCP Integration**: Acts as a Model Context Protocol server to provide semantic search capabilities to AI agents.

## Tech Stack
- **Runtime**: Node.js / TypeScript
- **Vector DB**: Qdrant (REST API)
- **Validation**: Zod (for configuration and API responses)
- **CLI UI**: `commander`, `ora`, `chalk`, `@clack/prompts`
